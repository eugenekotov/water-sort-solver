"use strict";(self.webpackChunkwater_sort_solver=self.webpackChunkwater_sort_solver||[]).push([[624],{624:(Y,K,d)=>{var c=(()=>{return(s=c||(c={})).RED="#C52B23",s.ORANGE="#E88C41 ",s.YELLOW="#F1DA58",s.DARK_GREEN="#116533",s.GREEN="#78970E",s.LIGHT_GREEN="#61D67D",s.BLUE="#55A3E5",s.DARK_BLUE="#3B2EC4",s.VIOLET="#722B93",s.PINK="#EA5E7B",s.BROWN="#7D4A08",s.GREY="#636466",c;var s})();class O{static colorOrdinal(e){return void 0===e?Object.values(c).length:Object.values(c).findIndex(t=>t===e)}static colorToBinaryData(e){const t=new Array(4),r=O.colorOrdinal(e);return t[0]=this.getBit(r,3),t[1]=this.getBit(r,2),t[2]=this.getBit(r,1),t[3]=this.getBit(r,0),t}static colorToHex(e){return O.colorOrdinal(e).toString(16).toUpperCase()}static getBit(e,t){return 0==(e&Math.pow(2,t))?0:1}}class i{constructor(e){this.colors=[],this.resolved=!1,this.index=e}peek(){return this.isEmpty()&&console.error("Container is empty."),this.colors[this.colors.length-1]}size(){return this.colors.length}pop(){return this.isEmpty()&&console.error("Container is empty."),this.resolved=!1,this.colors.pop()}push(e){this.colors.push(e),this.checkResolved()}isEmpty(){return 0===this.size()}isFull(){return 4===this.size()}getTopColorCount(){if(this.isEmpty())return 0;let e=1;const t=this.peek();let r=this.size()-2;for(;r>=0&&this.colors[r]===t;)e++,r--;return e}checkResolved(){return i.checkResolved(this)}clear(){this.colors=[],this.resolved=!1}static equal(e,t){if(e.colors.length!==t.colors.length)return!1;for(let r=0;r<e.colors.length;r++)if(e.colors[r]!==t.colors[r])return!1;return!0}static compare(e,t){if(e.colors.length!==t.colors.length)return e.colors.length-t.colors.length;for(let r=e.colors.length-1;r>=0;r--){const o=e.colors[r],l=Object.values(c).findIndex(m=>m===o),f=e.colors[r],N=Object.values(c).findIndex(m=>m===o);if(o!==f)return l-N}return 0}static clone(e){const t=new i(e.index);return t.colors=[...e.colors],t.resolved=e.resolved,t}static cloneContainers(e){return e.map(t=>i.clone(t))}static checkResolvedContainers(e){return e.forEach(t=>t.checkResolved())}static isResolvedContainers(e){return e.every(t=>0===t.colors.length||t.resolved)}static getColor(e,t){return t<e.colors.length?e.colors[t]:void 0}static containerToHex(e){let t="";for(let r=3;r>=0;r--){let o=i.getColor(e,r);t+=O.colorToHex(o)}return t}static checkResolved(e){return e.resolved=i.isFull(e)&&i.hasOnlyOneColor(e),e.resolved}static size(e){return e.colors.length}static isEmpty(e){return 0===i.size(e)}static isFull(e){return 4===i.size(e)}static peek(e){return e.colors[e.colors.length-1]}static push(e,t){e.colors.push(t),i.checkResolved(e)}static pop(e){e.resolved=!1;const t=e.colors.pop();if(!t)throw new Error("Cannot pop color from empty container");return t}static hasOnlyThreeOfOneColor(e){return 3===i.size(e)&&e.colors[0]===e.colors[1]&&e.colors[0]===e.colors[2]}static hasOnlyTwoOfOneColor(e){return 2===i.size(e)&&e.colors[0]===e.colors[1]}static hasOnlyOneOfOneColor(e){return 1===i.size(e)}static hasOnlyOneColor(e){return!i.isEmpty(e)&&e.colors.every(t=>t===e.colors[0])}static getElementId(e,t){return"container"+e+"item"+t}}class S{static getGameHash(e){let t="";return(e=i.cloneContainers(e)).sort(i.compare),e.forEach(r=>t+=i.containerToHex(r)),t}}class p{constructor(e,t,r){this.notes="",this.iFrom=e,this.iTo=t,this.color=r,this.count=1}clone(){return p.clone(this)}equals(e){return this.iFrom===e.iFrom&&this.iTo===e.iTo&&this.color===e.color}static clone(e){const t=new p(e.iFrom,e.iTo,e.color);return t.notes=e.notes,t.count=e.count,t}}var h=(()=>{return(s=h||(h={}))[s.CANCEL=0]="CANCEL",s[s.NO_SOLUTION=1]="NO_SOLUTION",s[s.SOLUTION=2]="SOLUTION",s[s.BEST_SOLUTION=3]="BEST_SOLUTION",h;var s})();class g{constructor(){this.stepCount=0,this.hashes=new Set,this.steps=[]}}function v(s,e,t,r,o){s=i.cloneContainers(s);for(let l=0;l<r;l++)i.push(s[t],i.pop(s[e])),o.steps.push(new p(s[e].index,s[t].index,i.peek(s[t])));return o.containers=s,o.stepCount=o.stepCount+r,o.hashes.add(S.getGameHash(s)),s}class C{constructor(){this.steps=[]}static clone(e){const t=new C;return t.steps=e.steps.map(r=>p.clone(r)),t}}class R{constructor(){this.solutions=[]}}class z{constructor(){this.containers=[],this.hashes=new Set,this.steps=[],this.solutions=new R,this.bestSolution=void 0,this.counter=0,this.logicFunctions=[]}}function I(s,e,t){if(s.counter++,i.isResolvedContainers(e))return void y(s);const r=function B(s,e){const t=new g;let r=!0;for(;r;)r=!1,s.logicFunctions.forEach(o=>{const l=o(e);l.stepCount>0&&(r=!0,e=l.containers,t.stepCount=t.stepCount+l.stepCount,t.hashes=new Set([...t.hashes,...l.hashes]),t.steps=[...t.steps,...l.steps])});return t.containers=e,t}(s,e);if(r.stepCount>0&&(e=r.containers,t+=r.stepCount,s.hashes=new Set([...s.hashes,...r.hashes]),s.steps=[...s.steps,...r.steps],i.isResolvedContainers(e)))y(s);else for(let o=0;o<e.length;o++)for(let l=0;l<e.length;l++)o!==l&&M(s,e,o,l,t)}function M(s,e,t,r,o){i.isEmpty(e[t])||i.isFull(e[r])||!i.isEmpty(e[r])&&i.peek(e[t])!=i.peek(e[r])||1==i.size(e[t])&&i.isEmpty(e[r])||i.hasOnlyThreeOfOneColor(e[t])||i.hasOnlyOneColor(e[t])&&i.isEmpty(e[r])||(e=function H(s,e,t){return s=i.cloneContainers(s),i.push(s[t],i.pop(s[e])),s}(e,t,r),!s.hashes.has(S.getGameHash(e))&&(s.steps.push(new p(e[t].index,e[r].index,i.peek(e[r]))),s.hashes.add(S.getGameHash(e)),I(s,e,o+1),function _(s,e){for(;s.steps.length>e;)s.steps.pop()}(s,o)))}function y(s){const e=function j(s){const e=s.steps;let l=0,f=!0;for(;f;){for(f=!1,l=0;l<e.length-1;){let n=l+1;for(;n<e.length&&(e[l].iFrom!==e[n].iTo||e[l].iTo!==e[n].iFrom)&&e[l].iFrom!==e[n].iFrom&&e[l].iFrom!==e[n].iTo&&e[l].iTo!==e[n].iFrom&&e[l].iTo!==e[n].iTo;)n++;n<e.length&&e[l].iFrom===e[n].iTo&&e[l].iTo===e[n].iFrom?(e.splice(n,1),e.splice(l,1),f=!0):l++}for(l=0;l<e.length-1;){let u=l+1;for(;u<e.length&&(e[l].iTo!==e[u].iFrom||e[l].color!==e[u].color);)u++;if(u<e.length&&e[l].iTo===e[u].iFrom&&e[l].color===e[u].color){let n=[e[l].iFrom,e[l].iTo,e[u].iFrom,e[u].iTo],w=u-1,a=!1;for(;l<w;){if(n.includes(e[w].iFrom)||n.includes(e[w].iTo)){a=!0;break}w--}a?l++:(e[l].iTo=e[u].iTo,e[l].notes="Updated by optimization 2",e.splice(u,1),f=!0)}else l++}for(l=0;l<e.length-1;)e[l].iFrom===e[l].iTo?(e.splice(l,1),f=!0):l++}for(l=0;l<e.length-1;)e[l].iFrom===e[l+1].iFrom&&e[l].iTo===e[l+1].iTo?(e[l+1].count=e[l+1].count+e[l].count,e.splice(l,1)):l++;return s}(function b(s){const e=new C;return e.steps=[],s.forEach(t=>e.steps.push(t.clone())),e}(s.steps));(function x(s,e){return!s.solutions.some(t=>function A(s,e){if(s.steps.length!==e.steps.length)return!1;for(let t=0;t<s.steps.length;t++)if(!s.steps[t].equals(e.steps[t]))return!1;return!0}(t,e))&&(s.solutions.push(e),!0)})(s.solutions,e)&&(void 0===s.bestSolution||e.steps.length<s.bestSolution.steps.length)&&(s.bestSolution=e,T(h.SOLUTION,e))}function T(s,e){postMessage({result:s,solution:e})}addEventListener("message",({data:s})=>{!function U(s){const e=new z;e.containers=s,e.hashes=new Set,e.steps=[],e.solutions.solutions=[],e.bestSolution=void 0,e.counter=0,e.logicFunctions.push(function k(){return e=>{const t=new g;let r=!0;for(;r;){r=!1;for(let o=0;o<e.length;o++)if(i.hasOnlyThreeOfOneColor(e[o])){const l=s(e,e[o].colors[0],o);if(-1!==l){e=v(e,l,o,1,t),r=!0;break}}}return t};function s(e,t,r){for(let o=0;o<e.length;o++)if(o!==r&&!i.isEmpty(e[o])&&i.peek(e[o])===t)return o;return-1}}()),e.logicFunctions.push(function L(){return e=>{const t=new g;let r=!0;for(;r;){r=!1;for(let o=0;o<e.length;o++)if(i.hasOnlyTwoOfOneColor(e[o])){const l=s(e,e[o].colors[0],o);if(-1!==l){e=v(e,l,o,2,t),r=!0;break}}}return t};function s(e,t,r){for(let o=0;o<e.length;o++)if(o!==r&&i.size(e[o])>1&&e[o].colors[i.size(e[o])-1]===t&&e[o].colors[i.size(e[o])-2]===t)return o;return-1}}()),e.logicFunctions.push(function F(){return e=>{const t=new g;let r=!0;for(;r;){r=!1;for(let o=0;o<e.length;o++)if(i.hasOnlyOneOfOneColor(e[o])){const l=s(e,e[o].colors[0],o);if(-1!==l){e=v(e,l,o,3,t),r=!0;break}}}return t};function s(e,t,r){for(let o=0;o<e.length;o++)if(o!==r&&4==i.size(e[o])&&e[o].colors[i.size(e[o])-1]===t&&e[o].colors[i.size(e[o])-2]===t&&e[o].colors[i.size(e[o])-3]===t)return o;return-1}}()),I(e,i.cloneContainers(e.containers),0),void 0===e.bestSolution?T(h.NO_SOLUTION,void 0):T(h.BEST_SOLUTION,e.bestSolution)}(s)})}}]);